# HIP-3 Bot Configuration - Trading Mode (Parallel Execution)
# Purpose: Test Position Tracker Sync fix with live trading
# Runs alongside Observation container for comparison
#
# Key features being tested:
# - Post response fill -> Position update (P0)
# - cloid-based fill deduplication (P0)
# - Periodic position resync (P1, 60s interval)

mode = "trading"
ws_url = "wss://api.hyperliquid.xyz/ws"
info_url = "https://api.hyperliquid.xyz/info"
xyz_pattern = "xyz"
is_mainnet = true

# Account configuration (API wallet setup)
user_address = "0x0116A3D95994BcC7D6A84380ED6256FBb32cD25D"
signer_address = "0xbf8e23f88aead1a3b17d1ad39ef766e9f77de281"
private_key = "0xd7fb667b6c9ecea9d66b6acc1f1d7b15c50dbcb93bff0eeff6a42de957fa155f"

# Trading markets: ALL xyz perp markets (2026-02-04)
# 42 markets total - threshold 40 bps (data-driven: 40bps+ = 100% win rate)

[[markets]]
asset_idx = 110000
coin = "xyz:XYZ100"
threshold_bps = 40

[[markets]]
asset_idx = 110001
coin = "xyz:TSLA"
threshold_bps = 40

[[markets]]
asset_idx = 110002
coin = "xyz:NVDA"
threshold_bps = 40

[[markets]]
asset_idx = 110003
coin = "xyz:GOLD"
threshold_bps = 40

[[markets]]
asset_idx = 110004
coin = "xyz:HOOD"
threshold_bps = 40

[[markets]]
asset_idx = 110005
coin = "xyz:INTC"
threshold_bps = 40

[[markets]]
asset_idx = 110006
coin = "xyz:PLTR"
threshold_bps = 40

[[markets]]
asset_idx = 110007
coin = "xyz:COIN"
threshold_bps = 50  # Higher spread market

[[markets]]
asset_idx = 110008
coin = "xyz:META"
threshold_bps = 40

[[markets]]
asset_idx = 110009
coin = "xyz:AAPL"
threshold_bps = 40

[[markets]]
asset_idx = 110010
coin = "xyz:MSFT"
threshold_bps = 40

[[markets]]
asset_idx = 110011
coin = "xyz:ORCL"
threshold_bps = 40

[[markets]]
asset_idx = 110012
coin = "xyz:GOOGL"
threshold_bps = 40

[[markets]]
asset_idx = 110013
coin = "xyz:AMZN"
threshold_bps = 40

[[markets]]
asset_idx = 110014
coin = "xyz:AMD"
threshold_bps = 40

[[markets]]
asset_idx = 110015
coin = "xyz:MU"
threshold_bps = 40

[[markets]]
asset_idx = 110016
coin = "xyz:SNDK"
threshold_bps = 40

[[markets]]
asset_idx = 110017
coin = "xyz:MSTR"
threshold_bps = 40

[[markets]]
asset_idx = 110018
coin = "xyz:CRCL"
threshold_bps = 40

[[markets]]
asset_idx = 110019
coin = "xyz:NFLX"
threshold_bps = 40

[[markets]]
asset_idx = 110020
coin = "xyz:COST"
threshold_bps = 40

[[markets]]
asset_idx = 110021
coin = "xyz:LLY"
threshold_bps = 40

[[markets]]
asset_idx = 110022
coin = "xyz:SKHX"
threshold_bps = 40

[[markets]]
asset_idx = 110023
coin = "xyz:TSM"
threshold_bps = 40

[[markets]]
asset_idx = 110024
coin = "xyz:JPY"
threshold_bps = 40

[[markets]]
asset_idx = 110025
coin = "xyz:EUR"
threshold_bps = 40

[[markets]]
asset_idx = 110026
coin = "xyz:SILVER"
threshold_bps = 40

[[markets]]
asset_idx = 110027
coin = "xyz:RIVN"
threshold_bps = 40

[[markets]]
asset_idx = 110028
coin = "xyz:BABA"
threshold_bps = 40

[[markets]]
asset_idx = 110029
coin = "xyz:CL"
threshold_bps = 40

[[markets]]
asset_idx = 110030
coin = "xyz:COPPER"
threshold_bps = 40

[[markets]]
asset_idx = 110031
coin = "xyz:NATGAS"
threshold_bps = 40

[[markets]]
asset_idx = 110032
coin = "xyz:URANIUM"
threshold_bps = 40

[[markets]]
asset_idx = 110033
coin = "xyz:ALUMINIUM"
threshold_bps = 40

[[markets]]
asset_idx = 110034
coin = "xyz:SMSN"
threshold_bps = 40

[[markets]]
asset_idx = 110035
coin = "xyz:PLATINUM"
threshold_bps = 40

[[markets]]
asset_idx = 110036
coin = "xyz:USAR"
threshold_bps = 40

[[markets]]
asset_idx = 110037
coin = "xyz:CRWV"
threshold_bps = 40

[[markets]]
asset_idx = 110038
coin = "xyz:URNM"
threshold_bps = 40

[[markets]]
asset_idx = 110039
coin = "xyz:PALLADIUM"
threshold_bps = 40

[[markets]]
asset_idx = 110040
coin = "xyz:DXY"
threshold_bps = 40

[[markets]]
asset_idx = 110041
coin = "xyz:GME"
threshold_bps = 40

[websocket]
max_reconnect_attempts = 0
reconnect_base_delay_ms = 1000
heartbeat_interval_ms = 45000

[risk]
max_oracle_age_ms = 8000
# Mark-Mid divergence gate disabled: 乖離 = MMが追従していない = エッジ（Trading Philosophy）
# Detector閾値（25-30 bps）でフィルタ済み
max_mark_mid_divergence_bps = 0
spread_shock_multiplier = 3
min_buffer_ratio = 0.15
max_oi_fraction = 0.01
# BBO stale gate disabled: BBOが更新されない = MMが怠惰 = エッジ（Trading Philosophy）
# WebSocket接続状態は ctx_update (8秒) でカバー
max_bbo_age_ms = 0

# Oracle Movement Tracker (P1)
# オラクルの連続性を追跡し、エントリー/エグジット判断に使用
[oracle_tracking]
# オラクルの動きを「変化」と見なす最小bps
# 小さすぎるとノイズ、大きすぎると動きを見逃す
min_move_bps = 2
# 保持する履歴数
max_history = 20
# Unchanged時の連続性: 維持（リセットしない）
# → オラクルが動かない = MMが追従する時間を与えるだけ、トレンドは継続

[detector]
taker_fee_bps = 2              # Actual fee ~0.79 bps, but 2 bps for safety (HIP-3 multiplier applied: 2×2=4)
# 2026-02-03: Measured spread 8-13 bps per side, 16-26 bps round trip
slippage_bps = 25              # 20 → 25: More realistic spread estimate (25 bps round trip)
min_edge_bps = 30              # 25 → 30: Require edge > spread cost to be profitable
oracle_direction_filter = false # Disable: 40+ bps signals being blocked by Unchanged oracle direction
min_oracle_change_bps = 0      # Disable: Velocity filter blocking signals with stale oracle
# Oracle consecutive filter (P2): エントリー前にオラクルがN回連続で同方向に動いていることを要求
# データ分析結果:
#   連続0回: 平均エッジ 29.79 bps → 避ける
#   連続1回: 平均エッジ 41.98 bps (+12.2 bps)
#   連続2回: 平均エッジ 43.43 bps (+13.6 bps) ← 採用（コスパ最良）
#   連続3回以上: 改善小さくサンプル減少
min_consecutive_oracle_moves = 2
sizing_alpha = 0.10
max_notional = 50
min_book_notional = 50
normal_book_notional = 5000
#
# Quote Lag Gate (PR-5: True Stale Liquidity)
# Only generate signals when oracle changed within this time window.
# Both set to 0 = disabled (backwards compatible)
#
# Trading Philosophy: "Oracle moves → MM quotes lag → capture stale liquidity"
# - Too fresh (<50ms): May be noise, oracle will stabilize
# - Sweet spot (50-500ms): True stale liquidity opportunity
# - Too stale (>500ms): MM has already adjusted quotes
#
min_quote_lag_ms = 0   # 0=disabled, 推奨: 50ms (ノイズフィルタ)
max_quote_lag_ms = 0   # 0=disabled, 推奨: 500ms (MM追従フィルタ)

[persistence]
data_dir = "./data/signals-trading"
buffer_size = 10

[telemetry]
metrics_port = 9091
log_level = "debug"

# Oracle-Driven Exit (P3) - メインのExit戦略
# TimeStopの代わりにオラクルの動きでエグジット判断
[oracle_exit]
enabled = true
# 損切り: 反対方向にN回連続で動いたら exit（エッジ消失）
# データ分析: 低エッジ時91%に低下を防ぐため素早い損切り
exit_against_moves = 2
# 利確: 我々の方向にN回連続で動いたら exit（MMがキャッチアップ）
# スプレッドが圧縮される前に利確
exit_with_moves = 3
# 最小保持時間: 無効化（Oracle連続性チェックで既にフィルタ済み）
min_holding_time_ms = 0
# スリッページ
slippage_bps = 50

[time_stop]
# Oracle-driven exitがメイン、TimeStopはバックアップ（非常用ハードリミット）
# オラクルが動かない異常事態でのみ発火
threshold_ms = 60000            # 15s → 60s: 非常用ハードリミット
reduce_only_timeout_ms = 60000
check_interval_ms = 500
slippage_bps = 50

[mark_regression]
enabled = true
# 2026-02-03: With 60 bps entry threshold, mark should regress significantly for profitable exit
exit_threshold_bps = 25         # 30 → 25 bps: Tighter exit to capture smaller regressions
check_interval_ms = 100
min_holding_time_ms = 2000      # 300ms → 2s: Filter noise, wait for true regression signal
slippage_bps = 50

[executor]
batch_interval_ms = 20          # 100ms → 20ms: Reduce latency (avg 50ms → 10ms)

[risk_monitor]
max_consecutive_failures = 5
max_loss_usd = 20.0
max_flatten_failed = 3
window_seconds = 3600

[position]
max_concurrent_positions = 10
max_total_notional = 300
max_notional_per_market = 100  # Hard cap (increased since dynamic sizing takes over)
position_resync_interval_secs = 60

[position.dynamic_sizing]
enabled = true
risk_per_market_pct = 1.0  # 100% of balance allowed per market (limited by max_notional_per_market)

[dashboard]
enabled = true
port = 8080
update_interval_ms = 100
max_connections = 10
username = ""
password = ""
