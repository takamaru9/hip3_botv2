# HIP-3 Bot Configuration - Trading Mode (Parallel Execution)
# 2026-02-14: Phase D - Session-Aware + Quality Filter Restoration
#   - session_aware=true: US Market Open 2x threshold, US Active 1.5x threshold
#   - min_consecutive_oracle_moves: 1→2 (data-validated +12bps edge)
#   - min_confidence_entry: 0.0→0.25 (re-enable quality filter)
#   - HOOD threshold: 25→35 (biggest loser Feb 13: -$0.28)
#   - max_quote_lag_ms: 1000→700 (tighten)
#   - Blackout: 14:33→14:40 (extend market open protection)
#
# Rationale (Feb 12-13 data):
#   Night/PreMkt (00-14 UTC): 35 trades, profitable (+$0.09)
#   US Market (14-21 UTC): 49 trades, 24.5% WR, net -$1.42
#   → session_aware preserves Night/PreMkt profitability
#     while raising bar during US hours

mode = "trading"
ws_url = "wss://api.hyperliquid.xyz/ws"
info_url = "https://api.hyperliquid.xyz/info"
xyz_pattern = "xyz"
is_mainnet = true

# Account configuration (API wallet setup)
user_address = "0x0116A3D95994BcC7D6A84380ED6256FBb32cD25D"
signer_address = "0xbf8e23f88aead1a3b17d1ad39ef766e9f77de281"
private_key = "0xd7fb667b6c9ecea9d66b6acc1f1d7b15c50dbcb93bff0eeff6a42de957fa155f"

# Trading markets: ALL xyz perp markets
# Phase A thresholds (2026-02-12) maintained for Night/PreMkt profitability
# session_aware handles US hours (threshold x1.5-2.0)

[[markets]]
asset_idx = 110000
coin = "xyz:XYZ100"
threshold_bps = 25  # was 40 (Phase A)

[[markets]]
asset_idx = 110001
coin = "xyz:TSLA"
threshold_bps = 20  # was 30 (Phase A)

[[markets]]
asset_idx = 110002
coin = "xyz:NVDA"
threshold_bps = 20  # was 30 (Phase A)

[[markets]]
asset_idx = 110003
coin = "xyz:GOLD"
threshold_bps = 50  # was 80 (Phase A)

[[markets]]
asset_idx = 110004
coin = "xyz:HOOD"
# 2026-02-17: Raised 35→60. Edge decay 5%@5s = structural spread, not stale liquidity.
# Feb 17: -$0.014 loss. Consistent loser across all sessions.
threshold_bps = 60

[[markets]]
asset_idx = 110005
coin = "xyz:INTC"
threshold_bps = 25  # was 40 (Phase A)

[[markets]]
asset_idx = 110006
coin = "xyz:PLTR"
threshold_bps = 20  # was 30 (Phase A). session_aware: 40/30 during US hours

[[markets]]
asset_idx = 110007
coin = "xyz:COIN"
threshold_bps = 999  # DISABLED

[[markets]]
asset_idx = 110008
coin = "xyz:META"
threshold_bps = 20  # was 30 (Phase A). session_aware: 40/30 during US hours

[[markets]]
asset_idx = 110009
coin = "xyz:AAPL"
threshold_bps = 20  # was 30 (Phase A). session_aware: 40/30 during US hours

[[markets]]
asset_idx = 110010
coin = "xyz:MSFT"
threshold_bps = 20  # was 30 (Phase A). session_aware: 40/30 during US hours

[[markets]]
asset_idx = 110011
coin = "xyz:ORCL"
threshold_bps = 25  # was 40 (Phase A)

[[markets]]
asset_idx = 110012
coin = "xyz:GOOGL"
threshold_bps = 999  # DISABLED

[[markets]]
asset_idx = 110013
coin = "xyz:AMZN"
threshold_bps = 20  # was 30 (Phase A). Winner market.

[[markets]]
asset_idx = 110014
coin = "xyz:AMD"
threshold_bps = 20  # was 30 (Phase A). session_aware: 40/30 during US hours

[[markets]]
asset_idx = 110015
coin = "xyz:MU"
threshold_bps = 50  # was 80 (Phase A)

[[markets]]
asset_idx = 110016
coin = "xyz:SNDK"
threshold_bps = 80  # was 100, lowered slightly (Phase A)

[[markets]]
asset_idx = 110017
coin = "xyz:MSTR"
threshold_bps = 999  # DISABLED

[[markets]]
asset_idx = 110018
coin = "xyz:CRCL"
threshold_bps = 50  # was 80 (Phase A)

[[markets]]
asset_idx = 110019
coin = "xyz:NFLX"
threshold_bps = 20  # was 30 (Phase A). Winner market.

[[markets]]
asset_idx = 110020
coin = "xyz:COST"
threshold_bps = 25  # was 40 (Phase A)

[[markets]]
asset_idx = 110021
coin = "xyz:LLY"
threshold_bps = 25  # was 40 (Phase A)

[[markets]]
asset_idx = 110022
coin = "xyz:SKHX"
threshold_bps = 25  # was 40 (Phase A)

[[markets]]
asset_idx = 110023
coin = "xyz:TSM"
threshold_bps = 999  # DISABLED

[[markets]]
asset_idx = 110024
coin = "xyz:JPY"
threshold_bps = 25  # was 40 (Phase A)

[[markets]]
asset_idx = 110025
coin = "xyz:EUR"
threshold_bps = 25  # was 40 (Phase A)

[[markets]]
asset_idx = 110026
coin = "xyz:SILVER"
# 2026-02-17: Raised 50→70. Mixed edge decay (40%), but consistent loser.
# Feb 17: -$0.060. All SILVER trades this period are losses.
threshold_bps = 70

[[markets]]
asset_idx = 110027
coin = "xyz:RIVN"
threshold_bps = 999  # DISABLED

[[markets]]
asset_idx = 110028
coin = "xyz:BABA"
threshold_bps = 25  # was 40 (Phase A). Winner market.

[[markets]]
asset_idx = 110029
coin = "xyz:CL"
threshold_bps = 25  # was 40 (Phase A)

[[markets]]
asset_idx = 110030
coin = "xyz:COPPER"
threshold_bps = 50  # was 80 (Phase A)

[[markets]]
asset_idx = 110031
coin = "xyz:NATGAS"
threshold_bps = 999  # DISABLED

[[markets]]
asset_idx = 110032
coin = "xyz:URANIUM"
threshold_bps = 25  # was 40 (Phase A)

[[markets]]
asset_idx = 110033
coin = "xyz:ALUMINIUM"
threshold_bps = 25  # was 40 (Phase A)

[[markets]]
asset_idx = 110034
coin = "xyz:SMSN"
threshold_bps = 25  # was 40 (Phase A)

[[markets]]
asset_idx = 110035
coin = "xyz:PLATINUM"
threshold_bps = 80  # was 120 (Phase A)

[[markets]]
asset_idx = 110036
coin = "xyz:USAR"
threshold_bps = 150  # keep (structural)

[[markets]]
asset_idx = 110037
coin = "xyz:CRWV"
threshold_bps = 999  # DISABLED

[[markets]]
asset_idx = 110038
coin = "xyz:URNM"
threshold_bps = 999  # DISABLED

[[markets]]
asset_idx = 110039
coin = "xyz:PALLADIUM"
threshold_bps = 25  # was 40 (Phase A)

[[markets]]
asset_idx = 110040
coin = "xyz:DXY"
threshold_bps = 25  # was 40 (Phase A)

[[markets]]
asset_idx = 110041
coin = "xyz:GME"
threshold_bps = 25  # was 40 (Phase A)

[websocket]
max_reconnect_attempts = 0
reconnect_base_delay_ms = 1000
heartbeat_interval_ms = 45000

[risk]
max_oracle_age_ms = 8000
# Mark-Mid divergence gate disabled: MM lag = edge (Trading Philosophy)
max_mark_mid_divergence_bps = 0
spread_shock_multiplier = 3
min_buffer_ratio = 0.15
max_oi_fraction = 0.01
# BBO stale gate disabled: stale BBO = lazy MM = edge
max_bbo_age_ms = 0

# Trading Blackout Windows (UTC)
[[risk.blackout_windows]]
start = "09:00"
end = "09:15"

[[risk.blackout_windows]]
# 2026-02-17: Extended to 14:25 start. Feb 17 data: 14:28 UTC trades (pre-open)
# caused -$0.251 (71% of total loss). Oracle whipsaw in final 5min before open.
start = "14:25"
end = "14:40"

# Oracle Movement Tracker
[oracle_tracking]
min_move_bps = 2
max_history = 20

[detector]
taker_fee_bps = 2
slippage_bps = 25
min_edge_bps = 30
oracle_direction_filter = true
min_oracle_change_bps = 0
# 2026-02-14: Restored from 1→2. Data-validated +12bps edge improvement.
# Phase A set to 1, but Feb 13 showed degraded quality.
min_consecutive_oracle_moves = 2
sizing_alpha = 0.10
max_notional = 50
min_book_notional = 50
normal_book_notional = 5000
adaptive_threshold = true
spread_threshold_multiplier = 1.5
confidence_sizing = true
baseline_tracking = true
baseline_alpha = 0.001
baseline_min_samples = 100
# 2026-02-17: Raised 5→8. Feb 17: trades with net_edge <5bps all lost.
# Round-trip fees ~$0.008 on $10 notional = 8bps. Must exceed fee threshold.
min_edge_above_baseline_bps = 8
edge_velocity_gate = false
min_edge_velocity_bps = 5
# 2026-02-14: Restored from 0.0→0.25. 0.0 admitted too many low-quality signals.
# Compromise between 0.35 (too strict) and 0.0 (too lax).
min_confidence_entry = 0.25
min_quote_lag_ms = 30  # Phase A value
# 2026-02-14: Tightened from 1000→700. Very stale quotes (>700ms) are not genuine edge.
max_quote_lag_ms = 700
exit_profile_enabled = false
# 2026-02-14: ENABLED. Key change addressing US hours losses.
# MarketOpen (14:30-16:00): threshold x2.0, sizing x0.5
# USActive (16:00-21:00): threshold x1.5, sizing x0.75
# Other (Night/PreMkt): unchanged (preserves profitable time periods)
# Effect: 20bps threshold → 40bps during MarketOpen, 30bps during USActive
session_aware = true
# Structural improvement: signal dedup (default true - eliminates 37x duplicate signals)
signal_dedup_enabled = true
# Structural improvement: spread gate (0 = disabled, enable with 150 after observation)
max_entry_spread_bps = 0
# Structural improvement: short-side throttle (disabled, enable after observation)
short_side_throttle = false
short_threshold_mult = 1.5
# Structural improvement: velocity weight (disabled, enable after observation)
velocity_weight_enabled = false
velocity_reference_bps = 10
# Structural improvement: correlation filter (disabled, enable after observation)
correlation_filter_enabled = false
correlation_max_simultaneous = 3

[persistence]
data_dir = "./data/signals-trading"
buffer_size = 10

[telemetry]
metrics_port = 9091
log_level = "debug"

# Oracle-Driven Exit (P3)
[oracle_exit]
enabled = true
exit_against_moves = 2
exit_with_moves = 3
min_holding_time_ms = 0
slippage_bps = 50
trailing_stop = true
activation_bps = 5
trail_bps = 3
exit_profile_enabled = false

[time_stop]
threshold_ms = 20000   # was 60000. 20s hard stop (edge decays well before 60s).
reduce_only_timeout_ms = 60000
check_interval_ms = 500
slippage_bps = 50

[tilt_guard]
# 2026-02-14: ENABLED. Prevents cascade losses during losing streaks.
# Data: 3+ consecutive losses → WR drops from 32.8% to 20.4% (-12%).
# Effect: After 3 losses, pause 5 min. Win resets counter. Zero impact on winning streaks.
enabled = true
max_consecutive_losses = 3
cooldown_secs = 300

[re_entry_delay]
# 2026-02-14: ENABLED. Same-market re-entry quality degradation.
# Data: First entry WR 45.1% → 2nd+ entry WR 30.2% (-15%).
# Effect: 30s cooldown after closing position in a market. Per-market isolation.
enabled = true
re_entry_delay_ms = 30000

[mark_regression]
enabled = true
exit_threshold_bps = 25
check_interval_ms = 100
min_holding_time_ms = 1500  # was 5000. Quick Profit/Edge Evap bypass this safely.
slippage_bps = 50
time_decay_enabled = true
decay_start_ms = 3000      # was 8000. Edge 1-3s → start decay at 3s.
min_decay_factor = 0.4     # was 0.5. 25bps × 0.4 = 10bps minimum threshold.
# Phase B: PnL direction check - skip MarkRegression exit for small losses
min_loss_exit_bps = 15
# Phase C: Entry edge-linked dynamic exit threshold
entry_edge_scaling = true
entry_edge_scale_factor = 0.5
# Quick Profit Take: immediate exit when profit >= 3bps (bypasses min_holding)
quick_profit_bps = 3
quick_profit_min_holding_ms = 500
# Edge Evaporation Exit: exit when entry-side edge disappears (MM caught up)
edge_evap_enabled = true
edge_evap_min_holding_ms = 500
edge_evap_threshold_bps = 2

[executor]
batch_interval_ms = 20

[risk_monitor]
max_consecutive_failures = 5
max_loss_usd = 20.0
max_flatten_failed = 3
window_seconds = 3600

[position]
max_concurrent_positions = 5
max_total_notional = 300
max_notional_per_market = 100
position_resync_interval_secs = 60

[position.dynamic_sizing]
enabled = true
risk_per_market_pct = 1.0

[dashboard]
enabled = true
port = 8080
update_interval_ms = 100
max_connections = 10
username = ""
password = ""

[max_drawdown]
max_hourly_drawdown_usd = 10.0
reset_interval_secs = 3600

[correlation_cooldown]
correlation_close_threshold = 3
correlation_window_secs = 30
correlation_cooldown_secs = 120

[burst_signal]
enabled = true
burst_window_secs = 900       # 1800→900 (30min→15min window)
burst_max_signals = 5         # 3→5 (allow more signals per window)
burst_cooldown_secs = 180     # 300→180 (5min→3min cooldown)
burst_bypass_edge_bps = 100   # 100bps+ signals bypass burst limit

[market_health]
enabled = true
window_size = 20
disable_threshold = 0.3
re_enable_threshold = 0.5
min_samples_to_disable = 10
