# HIP-3 Bot Configuration - Trading Mode (Parallel Execution)
# Purpose: Test Position Tracker Sync fix with live trading
# Runs alongside Observation container for comparison
#
# Key features being tested:
# - Post response fill -> Position update (P0)
# - cloid-based fill deduplication (P0)
# - Periodic position resync (P1, 60s interval)

mode = "trading"
ws_url = "wss://api.hyperliquid.xyz/ws"
info_url = "https://api.hyperliquid.xyz/info"
xyz_pattern = "xyz"
is_mainnet = true

# Account configuration (API wallet setup)
user_address = "0x0116A3D95994BcC7D6A84380ED6256FBb32cD25D"
signer_address = "0xbf8e23f88aead1a3b17d1ad39ef766e9f77de281"
private_key = "0xd7fb667b6c9ecea9d66b6acc1f1d7b15c50dbcb93bff0eeff6a42de957fa155f"

# Trading markets: Optimized with Oracle Direction Filter (2026-02-01)
#
# Oracle direction filter enabled (default=true):
# - Buy signals: Only when oracle is rising (stale ask)
# - Sell signals: Only when oracle is falling (stale bid)
# - Filters out "oracle lag" signals → lower thresholds viable
#
# Threshold strategy:
# - Balanced markets (>40% balance): 25 bps - more signals OK
# - Biased markets (<20% balance): 30 bps - filter handles bias
#
# | Market | Balance | Type     | Threshold |
# |--------|---------|----------|-----------|
# | SILVER | 74.2%   | Balanced | 25 bps    |
# | GOLD   | 47.7%   | Balanced | 25 bps    |
# | MSTR   | 14.0%   | Biased   | 30 bps    |
# | COPPER | 19.0%   | Biased   | 30 bps    |
# | COIN   | 15.2%   | Biased   | 30 bps    |

[[markets]]
asset_idx = 110026
coin = "xyz:SILVER"
threshold_bps = 25  # Balanced (74.2%) - oracle filter effective

[[markets]]
asset_idx = 110017
coin = "xyz:MSTR"
threshold_bps = 30  # Biased (14.0%) - filter removes oracle-lag buys

[[markets]]
asset_idx = 110030
coin = "xyz:COPPER"
threshold_bps = 30  # Biased (19.0%) - conservative with filter

[[markets]]
asset_idx = 110003
coin = "xyz:GOLD"
threshold_bps = 25  # Balanced (47.7%) - oracle filter effective

[[markets]]
asset_idx = 110007
coin = "xyz:COIN"
threshold_bps = 30  # Biased (15.2%) - filter removes oracle-lag buys

[websocket]
max_reconnect_attempts = 0
reconnect_base_delay_ms = 1000
heartbeat_interval_ms = 45000

[risk]
max_oracle_age_ms = 8000
# Mark-Mid divergence gate disabled: 乖離 = MMが追従していない = エッジ（Trading Philosophy）
# Detector閾値（25-30 bps）でフィルタ済み
max_mark_mid_divergence_bps = 0
spread_shock_multiplier = 3
min_buffer_ratio = 0.15
max_oi_fraction = 0.01
# BBO stale gate disabled: BBOが更新されない = MMが怠惰 = エッジ（Trading Philosophy）
# WebSocket接続状態は ctx_update (8秒) でカバー
max_bbo_age_ms = 0

[detector]
taker_fee_bps = 2              # Actual fee ~0.79 bps, but 2 bps for safety (HIP-3 multiplier applied: 2×2=4)
slippage_bps = 10              # Conservative slippage estimate
min_edge_bps = 15              # 10 → 15 bps: Increased based on edge erosion analysis (~22.6 bps)
sizing_alpha = 0.10
max_notional = 50
min_book_notional = 50
normal_book_notional = 5000

[persistence]
data_dir = "./data/signals-trading"
buffer_size = 10

[telemetry]
metrics_port = 9091
log_level = "debug"

[time_stop]
threshold_ms = 10000            # 15s → 10s: Faster exit (>15s has -8.35 bps loss)
reduce_only_timeout_ms = 60000
check_interval_ms = 500
slippage_bps = 50

[mark_regression]
enabled = true
exit_threshold_bps = 15         # 10 → 15 bps: Exit earlier when edge diminishes
check_interval_ms = 200
min_holding_time_ms = 500       # 1000 → 500ms: Allow faster exit (≤5s has +6.43 bps profit)
slippage_bps = 50

[executor]
batch_interval_ms = 20          # 100ms → 20ms: Reduce latency (avg 50ms → 10ms)

[risk_monitor]
max_consecutive_failures = 5
max_loss_usd = 20.0
max_flatten_failed = 3
window_seconds = 3600

[position]
max_concurrent_positions = 10
max_total_notional = 300
max_notional_per_market = 100  # Hard cap (increased since dynamic sizing takes over)
position_resync_interval_secs = 60

[position.dynamic_sizing]
enabled = true
risk_per_market_pct = 0.10  # 10% of account balance per market

[dashboard]
enabled = true
port = 8081
update_interval_ms = 100
max_connections = 10
username = ""
password = ""
