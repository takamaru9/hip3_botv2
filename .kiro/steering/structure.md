# Project Structure

## Organization Philosophy

**Domain-driven crate separation**: Each subdomain has its own crate with explicit dependencies. The application crate (`hip3-bot`) orchestrates all components.

## Directory Patterns

### Crates (`/crates/hip3-*/`)
**Location**: `/crates/hip3-{domain}/`
**Purpose**: Domain-specific functionality
**Pattern**: Each crate has `src/lib.rs` re-exporting public API

| Crate | Responsibility |
|-------|----------------|
| `hip3-core` | Shared types: `MarketKey`, `Price`, `Size`, `MarketSpec` |
| `hip3-ws` | WebSocket client, connection management, message parsing |
| `hip3-feed` | Market data aggregation, BBO state management |
| `hip3-registry` | Market metadata caching, spec validation |
| `hip3-risk` | Risk gates (8 checks), HardStop latch |
| `hip3-detector` | Dislocation detection, signal generation |
| `hip3-executor` | Order submission, signing, rate limiting |
| `hip3-position` | Position tracking, TimeStop auto-exit |
| `hip3-persistence` | Parquet signal recording |
| `hip3-telemetry` | Logging, Prometheus metrics |
| `hip3-dashboard` | Real-time web dashboard (REST API + WebSocket, port 8080) |
| `hip3-bot` | Application orchestration, config loading |

### Configuration (`/config/`)
**Location**: `/config/*.toml`
**Purpose**: Environment-specific settings
**Naming**: `default.toml` (dev), `mainnet-*.toml` (production variants)

### Analysis (`/analysis/`)
**Location**: `/analysis/`
**Purpose**: Post-hoc signal and performance analysis (Python)

### Review (`/review/`)
**Location**: `/review/`
**Purpose**: Code review documents (auto-generated by code-reviewer agent)

## Naming Conventions

- **Crates**: `hip3-{domain}` (kebab-case)
- **Modules**: `snake_case.rs`
- **Types**: `PascalCase` (e.g., `MarketKey`, `DislocationSignal`)
- **Functions**: `snake_case` (e.g., `check_gates`, `on_signal`)
- **Config keys**: `snake_case` in TOML

## Import Organization

```rust
// Standard library
use std::collections::HashMap;

// External crates
use tokio::sync::mpsc;
use tracing::info;

// Workspace crates
use hip3_core::{MarketKey, Price};

// Local modules
use crate::error::Result;
```

**Dependency Rules**:
- `hip3-core` is foundational - depended on by all other crates
- `hip3-bot` depends on all crates - never imported by others
- Crates should not have circular dependencies

## Code Organization Principles

### Module Pattern
Each crate follows:
```
src/
├── lib.rs          # Public API re-exports
├── error.rs        # Crate-specific error types
├── {component}.rs  # Main implementation
└── {helpers}.rs    # Supporting modules
```

### Error Handling
- Each crate defines its own `Error` and `Result` types
- Use `thiserror` for error definitions
- Propagate with `anyhow` at application boundary

### Configuration Pattern
- TOML for static configuration
- Config structs derive `Deserialize`
- Defaults implemented via `Default` trait

---
_Document patterns, not file trees. New files following patterns shouldn't require updates_
